<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">ivis/TimeBasedChartBase.js | ivis-core</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Just to make my dev environment a little easier to use."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="ivis-core"><meta property="twitter:description" content="Just to make my dev environment a little easier to use."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/dburian/ivis-core"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/AreaChart.js~AreaChart.html">AreaChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/BarChart.js~StaticBarChart.html">StaticBarChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/BubblePlot.js~BubblePlot.html">BubblePlot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataAccess.js~DataAccess.html">DataAccess</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataAccess.js~DataAccessSession.html">DataAccessSession</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataAccess.js~TimeSeriesPointProvider.html">TimeSeriesPointProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataAccess.js~TimeSeriesProvider.html">TimeSeriesProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataAccess.js~TimeSeriesSummaryProvider.html">TimeSeriesSummaryProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataPathApproximator.js~DataPathApproximator.html">DataPathApproximator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/FrequencyBarChart.js~FrequencyBarChart.html">FrequencyBarChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/FrequencyDataLoader.js~FrequencyDataLoader.html">FrequencyDataLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/FrequencyPieChart.js~FrequencyPieChart.html">FrequencyPieChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/HeatmapChart.js~HeatmapChart.html">HeatmapChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/HistogramChart.js~HistogramChart.html">HistogramChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Legend.js~Legend.html">Legend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Legend.js~StaticLegend.html">StaticLegend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/LineChart.js~LineChart.html">LineChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/LineChartBase.js~LineChartBase.html">LineChartBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/LiveAnimation.js~LiveAnimation.html">LiveAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/MinMaxLoader.js~MinMaxLoader.html">MinMaxLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/OnOffAreaChart.js~OnOffAreaChart.html">OnOffAreaChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PanelConfig.js~Configurator.html">Configurator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PanelConfig.js~PanelConfigAccess.html">PanelConfigAccess</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PanelConfig.js~PdfExportDialog.html">PdfExportDialog</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PanelConfig.js~PermanentLinkDialog.html">PermanentLinkDialog</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PanelConfig.js~SaveDialog.html">SaveDialog</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PieChart.js~StaticPieChart.html">StaticPieChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/RecordedAnimation.js~RecordedAnimation.html">RecordedAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Records.js~Records.html">Records</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/SVG.js~SVG.html">SVG</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/ScatterPlot.js~ScatterPlot.html">ScatterPlot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/ScatterPlotBase.js~ScatterPlotBase.html">ScatterPlotBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Selector.js~SignalSelector.html">SignalSelector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Selector.js~StaticSignalSelector.html">StaticSignalSelector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeBasedChartBase.js~TimeBasedChartBase.html">TimeBasedChartBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeContext.js~TimeContext.html">TimeContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeInterval.js~IntervalAbsolute.html">IntervalAbsolute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeInterval.js~IntervalHistory.html">IntervalHistory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeInterval.js~IntervalSpec.html">IntervalSpec</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeInterval.js~TimeInterval.html">TimeInterval</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeRangeSelector.js~PredefTimeRangeSelector.html">PredefTimeRangeSelector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeRangeSelector.js~TimeRangeSelector.html">TimeRangeSelector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Tooltip.js~Tooltip.html">Tooltip</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-animated">animated</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-forAggs">forAggs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getAxisIdx">getAxisIdx</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lineWithPointsOnHover">lineWithPointsOnHover</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lineWithoutPoints">lineWithoutPoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lineWithoutPointsAndPointsOnNoAggregation">lineWithoutPointsAndPointsOnNoAggregation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-nolineWithPointsAlways">nolineWithPointsAlways</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createBase">createBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isSignalVisible">isSignalVisible</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-intervalAccessMixin">intervalAccessMixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-defaultGetMinAggregationInterval">defaultGetMinAggregationInterval</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ModifyColorCopy">ModifyColorCopy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-WheelDelta">WheelDelta</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-brushHandlesLeftRight">brushHandlesLeftRight</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-brushHandlesTopBottom">brushHandlesTopBottom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-distance">distance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extentWithMargin">extentWithMargin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getColorScale">getColorScale</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getExtent">getExtent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isInExtent">isInExtent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isSignalVisible">isSignalVisible</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-roundTo">roundTo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setZoomTransform">setZoomTransform</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-transitionInterpolate">transitionInterpolate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-fileUrl">fileUrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnimationControlContext">AnimationControlContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnimationDataContext">AnimationDataContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnimationStatusContext">AnimationStatusContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-withAnimationControl">withAnimationControl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-withAnimationData">withAnimationData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-withAnimationStatus">withAnimationStatus</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TimeSeriesPointPredefs">TimeSeriesPointPredefs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TimeSeriesPointType">TimeSeriesPointType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-dataAccess">dataAccess</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PointsVisibility">PointsVisibility</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-pointsOnNoAggregation">pointsOnNoAggregation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PanelConfigOwnerContext">PanelConfigOwnerContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-panelConfigAccessMixin">panelConfigAccessMixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-panelConfigMixin">panelConfigMixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-withPanelConfig">withPanelConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-panelMenuMixin">panelMenuMixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-LegendPosition">LegendPosition</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ConfigDifference">ConfigDifference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RenderStatus">RenderStatus</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TimeIntervalsContext">TimeIntervalsContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ZoomEventSources">ZoomEventSources</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-dotShapeNames">dotShapeNames</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-dotShapes">dotShapes</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#attic">attic</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/attic/BarChart.js~BarChart.html">BarChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/attic/BarNavigator.js~LineNavigator.html">LineNavigator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/attic/LineNavigator.js~BarNavigator.html">BarNavigator</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">ivis/TimeBasedChartBase.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

import React, {Component} from &quot;react&quot;;
import * as d3Axis from &quot;d3-axis&quot;;
import * as d3Scale from &quot;d3-scale&quot;;
import {event as d3Event, select} from &quot;d3-selection&quot;;
import * as d3Brush from &quot;d3-brush&quot;;
import {intervalAccessMixin} from &quot;./TimeContext&quot;;
import {DataAccessSession} from &quot;./DataAccess&quot;;
import {withAsyncErrorHandler, withErrorHandling} from &quot;../lib/error-handling&quot;;
import interoperableErrors from &quot;../../../shared/interoperable-errors&quot;;
import PropTypes from &quot;prop-types&quot;;
import {IntervalSpec} from &quot;./TimeInterval&quot;;
import {Tooltip} from &quot;./Tooltip&quot;;
import tooltipStyles from &quot;./Tooltip.scss&quot;;
import * as dateMath from &quot;../lib/datemath&quot;;
import {Icon} from &quot;../lib/bootstrap-components&quot;;
import {withComponentMixins} from &quot;../lib/decorator-helpers&quot;;
import {withTranslation} from &quot;../lib/i18n&quot;;

export function createBase(base, self) {
    self.base = base;
    return self;
}

export function isSignalVisible(sigConf) {
    return (&apos;label&apos; in sigConf) &amp;&amp; (!(&apos;enabled&apos; in sigConf) || sigConf.enabled);
}

class TooltipContent extends Component {
    constructor(props) {
        super(props);
    }

    static propTypes = {
        config: PropTypes.array.isRequired,
        signalSetsData: PropTypes.object,
        selection: PropTypes.object,
        getSignalValues: PropTypes.func.isRequired
    }

    render() {
        if (this.props.selection) {
            const rows = [];
            let ts;

            let sigSetIdx = 0;
            for (const sigSetConf of this.props.config) {
                const sel = this.props.selection[sigSetConf.cid];
                const isAgg = this.props.signalSetsData[sigSetConf.cid].isAggregated;

                if (sel) {
                    ts = sel.ts;
                    let sigIdx = 0;
                    for (const sigConf of sigSetConf.signals) {
                        if (isSignalVisible(sigConf)) {
                            const sigVals = this.props.getSignalValues(this, sigSetConf, sigConf, sigSetConf.cid, sigConf.cid, sel.data[sigConf.cid], isAgg);

                            if (sigVals) {
                                rows.push(
                                    &lt;div key={`${sigSetIdx} ${sigIdx}`}&gt;
                                        &lt;span className={tooltipStyles.signalColor} style={{color: sigConf.color}}&gt;&lt;Icon icon=&quot;minus&quot;/&gt;&lt;/span&gt;
                                        &lt;span className={tooltipStyles.signalLabel}&gt;{sigConf.label}:&lt;/span&gt;
                                        {this.props.getSignalValues(this, sigSetConf, sigConf, sigSetConf.cid, sigConf.cid, sel.data[sigConf.cid], isAgg)}
                                    &lt;/div&gt;
                                );
                            }
                        }

                        sigIdx += 1;
                    }
                }

                sigSetIdx += 1;
            }

            return (
                &lt;div&gt;
                    &lt;div className={tooltipStyles.time}&gt;{dateMath.format(ts)}&lt;/div&gt;
                    {rows}
                &lt;/div&gt;
            );

        } else {
            return null;
        }
    }
}

export const RenderStatus = {
    SUCCESS: 0,
    NO_DATA: 1
};



export const ConfigDifference = {
    // We assume here order from the most benign to the worst
    NONE: 0,
    RENDER: 1,
    DATA: 2
};

function compareConfigs(conf1, conf2, customComparator) {
    let diffResult = ConfigDifference.NONE;

    function compareColor(a, b) {
        return a.r === b.r &amp;&amp; a.g === b.g &amp;&amp; a.b === b.b &amp;&amp; a.opacity === b.opacity;
    }

    function compareSignal(sig1, sig2) {
        if (sig1.cid !== sig2.cid || sig1.mutate !== sig2.mutate || sig1.generate !== sig2.generate) {
            diffResult = ConfigDifference.DATA;
        } else if (!compareColor(sig1.color, sig2.color) || sig1.label !== sig2.label || sig1.enabled !== sig2.enabled) {
            diffResult = ConfigDifference.RENDER;
        }
    }


    function compareSigSet(sigSet1, sigSet2) {
        if (sigSet1.cid !== sigSet2.cid) {
            diffResult = ConfigDifference.DATA;
            return;
        }

        if (sigSet1.signals.length !== sigSet2.signals.length) {
            diffResult = ConfigDifference.DATA;
            return;
        }

        for (let idx = 0; idx &lt; sigSet1.signals.length; idx++) {
            compareSignal(sigSet1.signals[idx], sigSet2.signals[idx]);
            if (diffResult === ConfigDifference.DATA) {
                return;
            }
        }
    }

    function compareConf(conf1, conf2) {
        if (conf1.signalSets.length !== conf2.signalSets.length) {
            diffResult = ConfigDifference.DATA;
            return;
        }

        for (let idx = 0; idx &lt; conf1.signalSets.length; idx++) {
            compareSigSet(conf1.signalSets[idx], conf2.signalSets[idx]);
            if (diffResult === ConfigDifference.DATA) {
                return;
            }
        }

        if (customComparator) {
            const res = customComparator(conf1, conf2);
            if (res &gt; diffResult) {
                diffResult = res;
            }
        }
    }

    compareConf(conf1, conf2);
    return diffResult;
}


@withComponentMixins([
    withTranslation,
    withErrorHandling,
    intervalAccessMixin(),
])
export class TimeBasedChartBase extends Component {
    constructor(props){
        super(props);

        const t = props.t;

        this.dataAccessSession = new DataAccessSession();
        this.state = {
            selection: null,
            mousePosition: null,
            signalSetsData: null,
            statusMsg: t(&apos;Loading...&apos;),
            width: 0
        };

        this.resizeListener = () =&gt; {
            this.createChart(this.state.signalSetsData);
            this.updateTimeIntervalChartWidth();
        };

        this.delayedFetchDueToTimeIntervalChartWidthUpdate = false;
    }

    static propTypes = {
        config: PropTypes.object.isRequired,
        data: PropTypes.object,
        contentComponent: PropTypes.func,
        contentRender: PropTypes.func,
        height: PropTypes.number.isRequired,
        margin: PropTypes.object.isRequired,
        withBrush: PropTypes.bool,
        withTooltip: PropTypes.bool,
        tooltipContentComponent: PropTypes.func,
        tooltipContentRender: PropTypes.func,

        getSignalValuesForDefaultTooltip: PropTypes.func,
        getQueries: PropTypes.func.isRequired,
        prepareData: PropTypes.func.isRequired,
        createChart: PropTypes.func.isRequired,
        getGraphContent: PropTypes.func.isRequired,
        getSvgDefs: PropTypes.func,
        compareConfigs: PropTypes.func,

        tooltipExtraProps: PropTypes.object,

        minimumIntervalMs: PropTypes.number,

        controlTimeIntervalChartWidth: PropTypes.bool
    }

    static defaultProps = {
        tooltipExtraProps: {},
        minimumIntervalMs: 10000,
        getSvgDefs: () =&gt; null
    }

    updateTimeIntervalChartWidth() {
        const intv = this.getInterval();
        const width = this.containerNode.getClientRects()[0].width;

        if (this.props.controlTimeIntervalChartWidth &amp;&amp; intv.conf.chartWidth !== width) {
            intv.setConf({
                chartWidth: width
            });

            this.delayedFetchDueToTimeIntervalChartWidthUpdate = true;
        }
    }

    componentDidMount() {
        window.addEventListener(&apos;resize&apos;, this.resizeListener);

        // This causes the absolute interval to change, which in turn causes a data fetch
        this.resizeListener();

        if (!this.delayedFetchDueToTimeIntervalChartWidthUpdate) {
            this.fetchData();
        }

        // this.createChart(this.state.signalSetsData) is not needed here because at this point, we are missing too many things to actually execute it
    }

    componentDidUpdate(prevProps, prevState) {
        let signalSetsData = this.state.signalSetsData;

        const t = this.props.t;

        const configDiff = compareConfigs(prevProps.config, this.props.config, this.props.compareConfigs);

        const prevAbs = this.getIntervalAbsolute(prevProps);
        const prevSpec = this.getIntervalSpec(prevProps);
        if (configDiff === ConfigDifference.DATA || prevSpec !== this.getIntervalSpec() &amp;&amp; !this.props.data) {
            this.setState({
                signalSetsData: null,
                statusMsg: t(&apos;Loading...&apos;)
            });

            this.fetchData();

            signalSetsData = null;

        } else if (this.delayedFetchDueToTimeIntervalChartWidthUpdate || prevAbs !== this.getIntervalAbsolute() || this.props.data !== prevProps.data) { // If its just a regular refresh, don&apos;t clear the chart
            this.delayedFetchDueToTimeIntervalChartWidthUpdate = false;

            this.fetchData();

        } else {
            const forceRefresh = this.prevContainerNode !== this.containerNode
                || prevState.signalSetsData !== this.state.signalSetsData
                || configDiff !== ConfigDifference.NONE
                || this.getIntervalAbsolute(prevProps) !== this.getIntervalAbsolute();

            this.createChart(signalSetsData, forceRefresh);
            this.prevContainerNode = this.containerNode;
        }
    }

    componentWillUnmount() {
        window.removeEventListener(&apos;resize&apos;, this.resizeListener);
    }

    @withAsyncErrorHandler
    async fetchData() {
        const t = this.props.t;

        try {
            let results = null;

            if (this.props.data) {
                results = [this.props.data];
            } else {
                const queries = this.props.getQueries(this, this.getIntervalAbsolute(), this.props.config);

                results = await this.dataAccessSession.getLatestMixed(queries);
            }

            if (results) {
                // This converts NaNs and Infinity to null. D3 can handle nulls in data by omitting the data point
                for (const resultSet of results) {
                    for (const sigSetCid in resultSet) {
                        const sigSetData = resultSet[sigSetCid];

                        const processSignals = data =&gt; {
                            for (const sigCid in data) {
                                const sigData = data[sigCid];
                                for (const agg in sigData) {
                                    if (!isFinite(sigData[agg])) {
                                        sigData[agg] = null;
                                    }
                                }
                            }
                        };

                        if (sigSetData.prev) {
                            processSignals(sigSetData.prev.data);
                        }

                        if (sigSetData.main) {
                            for (const mainData of sigSetData.main) {
                                processSignals(mainData.data);
                            }
                        }

                        if (sigSetData.next) {
                            processSignals(sigSetData.next.data);
                        }
                    }
                }

                this.setState(this.props.prepareData(this, results));
            }
        } catch (err) {
            if (err instanceof interoperableErrors.TooManyPointsError) {
                this.setState({
                    statusMsg: t(&apos;Too many data points.&apos;)
                });
                return;
            }

            // throw err;
        }
    }

    createChart(signalSetsData, forceRefresh) {
        const t = this.props.t;
        const self = this;
        const intv = this.getInterval();

        const width = this.containerNode.getClientRects()[0].width;

        if (this.state.width !== width) {
            this.setState({
                width
            });
        }

        if (!forceRefresh &amp;&amp; width === this.renderedWidth) {
            return;
        }
        this.renderedWidth = width;

        if (!signalSetsData) {
            return;
        }

        const abs = this.getIntervalAbsolute();

        const xScale = d3Scale.scaleTime()
            .domain([abs.from, abs.to])
            .range([0, width - this.props.margin.left - this.props.margin.right]);

        const xAxis = d3Axis.axisBottom(xScale)
            .tickSizeOuter(0);

        this.xAxisSelection
            .call(xAxis);


        if (this.props.withBrush) {
            const brush = d3Brush.brushX()
                .extent([[0, 0], [width - this.props.margin.left - this.props.margin.right, this.props.height - this.props.margin.top - this.props.margin.bottom]])
                .on(&quot;end&quot;, function brushed() {
                    const sel = d3Event.selection;

                    if (sel) {
                        const selFrom = xScale.invert(sel[0]).valueOf();
                        let selTo = xScale.invert(sel[1]).valueOf();

                        if (selTo - selFrom &lt; self.props.minimumIntervalMs) {
                            selTo = selFrom + self.props.minimumIntervalMs;
                        }

                        const rounded = intv.roundToMinAggregationInterval(selFrom, selTo);

                        const spec = new IntervalSpec(
                            rounded.from,
                            rounded.to,
                            null
                        );

                        intv.setSpec(spec);

                        self.brushSelection.call(brush.move, null);
                    }
                });

            this.brushSelection
                .call(brush);

        } else {
            this.brushSelection
                .selectAll(&apos;rect&apos;)
                .remove();

            this.brushSelection.append(&apos;rect&apos;)
                .attr(&apos;pointer-events&apos;, &apos;all&apos;)
                .attr(&apos;cursor&apos;, &apos;crosshair&apos;)
                .attr(&apos;x&apos;, 0)
                .attr(&apos;y&apos;, 0)
                .attr(&apos;width&apos;, width - this.props.margin.left - this.props.margin.right)
                .attr(&apos;height&apos;, this.props.height - this.props.margin.top - this.props.margin.bottom)
                .attr(&apos;visibility&apos;, &apos;hidden&apos;);
        }


        this.cursorLineVisible = false;
        this.cursorSelection
            .attr(&apos;y1&apos;, this.props.margin.top)
            .attr(&apos;y2&apos;, this.props.height - this.props.margin.bottom);


        const renderStatus = this.props.createChart(this, signalSetsData, this.state, abs, xScale);

        if (renderStatus == RenderStatus.NO_DATA) {
            this.statusMsgSelection.text(t(&apos;No data.&apos;));
            //FIX ME: ugly solution, graphs need to clear old data
            select(this.graphContentNode).selectAll(&apos;g&apos;).attr(&quot;opacity&quot;, 0);
        } else if (renderStatus === RenderStatus.SUCCESS) {
            this.statusMsgSelection.text(null);
            //FIX ME: ugly solution, graphs need to clear old data
            select(this.graphContentNode).selectAll(&apos;g&apos;).attr(&quot;opacity&quot;, 1);
        }
    }

    render() {
        const config = this.props.config;

        if (!this.state.signalSetsData) {
            return (
                &lt;svg ref={node =&gt; this.containerNode = node} height={this.props.height} width=&quot;100%&quot;&gt;
                    &lt;text textAnchor=&quot;middle&quot; x=&quot;50%&quot; y=&quot;50%&quot; fontFamily=&quot;&apos;Open Sans&apos;,&apos;Helvetica Neue&apos;,Helvetica,Arial,sans-serif&quot; fontSize=&quot;14px&quot;&gt;
                        {this.state.statusMsg}
                    &lt;/text&gt;
                &lt;/svg&gt;
            );

        } else {

            let content = null;
            const contentProps = {
                selection: this.state.selection,
                mousePosition: this.state.mousePosition,
                containerHeight: this.props.height,
                containerWidth: this.state.width
            };
            if (this.props.contentComponent) {
                content = &lt;this.props.contentComponent {...contentProps}/&gt;;
            } else if (this.props.contentRender) {
                content = this.props.contentRender(contentProps);
            }

            const tooltipExtraProps = {...this.props.tooltipExtraProps};

            if (this.props.tooltipContentComponent) {
                tooltipExtraProps.contentComponent = tooltipContentComponent;
            } else if (this.props.contentRender) {
                tooltipExtraProps.contentRender = tooltipContentRender;
            } else {
                tooltipExtraProps.contentRender = (props) =&gt; &lt;TooltipContent getSignalValues={this.props.getSignalValuesForDefaultTooltip} {...props}/&gt;;
            }

            return (
                &lt;svg id=&quot;cnt&quot; ref={node =&gt; this.containerNode = node} height={this.props.height} width=&quot;100%&quot; &gt;
                    {this.props.getSvgDefs(this)}
                    &lt;defs&gt;
                        &lt;clipPath id=&quot;plotRect&quot;&gt;
                            &lt;rect x=&quot;0&quot; y=&quot;0&quot; width={this.state.width - this.props.margin.left - this.props.margin.right} height={this.props.height - this.props.margin.top - this.props.margin.bottom} /&gt;
                        &lt;/clipPath&gt;
                    &lt;/defs&gt;
                    &lt;g transform={`translate(${this.props.margin.left}, ${this.props.margin.top})`} clipPath=&quot;url(#plotRect)&quot; ref={node =&gt; this.graphContentNode = node}&gt;
                        {this.props.getGraphContent(this)}
                    &lt;/g&gt;
                    &lt;g ref={node =&gt; this.xAxisSelection = select(node)} transform={`translate(${this.props.margin.left}, ${this.props.height - this.props.margin.bottom})`}/&gt;
                    &lt;g ref={node =&gt; this.yAxisSelection = select(node)} transform={`translate(${this.props.margin.left}, ${this.props.margin.top})`}/&gt;
                    &lt;line ref={node =&gt; this.cursorSelection = select(node)} strokeWidth=&quot;1&quot; stroke=&quot;rgb(50,50,50)&quot; visibility=&quot;hidden&quot;/&gt;
                    &lt;text ref={node =&gt; this.statusMsgSelection = select(node)} textAnchor=&quot;middle&quot; x=&quot;50%&quot; y=&quot;50%&quot; fontFamily=&quot;&apos;Open Sans&apos;,&apos;Helvetica Neue&apos;,Helvetica,Arial,sans-serif&quot; fontSize=&quot;14px&quot;/&gt;
                    {this.props.withTooltip &amp;&amp;
                        &lt;Tooltip
                            config={this.props.config.signalSets}
                            signalSetsData={this.state.signalSetsData}
                            containerHeight={this.props.height}
                            containerWidth={this.state.width}
                            mousePosition={this.state.mousePosition}
                            selection={this.state.selection}
                            {...tooltipExtraProps}
                        /&gt;
                    }
                    {content}
                    &lt;g ref={node =&gt; this.brushSelection = select(node)} transform={`translate(${this.props.margin.left}, ${this.props.margin.top})`}/&gt;
                &lt;/svg&gt;
            );
        }
    }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
