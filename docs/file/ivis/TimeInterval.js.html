<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">ivis/TimeInterval.js | ivis-core</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Just to make my dev environment a little easier to use."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="ivis-core"><meta property="twitter:description" content="Just to make my dev environment a little easier to use."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/dburian/ivis-core"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/AreaChart.js~AreaChart.html">AreaChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/BarChart.js~StaticBarChart.html">StaticBarChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/BubblePlot.js~BubblePlot.html">BubblePlot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataAccess.js~DataAccess.html">DataAccess</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataAccess.js~DataAccessSession.html">DataAccessSession</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataAccess.js~TimeSeriesPointProvider.html">TimeSeriesPointProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataAccess.js~TimeSeriesProvider.html">TimeSeriesProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataAccess.js~TimeSeriesSummaryProvider.html">TimeSeriesSummaryProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/DataPathApproximator.js~DataPathApproximator.html">DataPathApproximator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/FrequencyBarChart.js~FrequencyBarChart.html">FrequencyBarChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/FrequencyDataLoader.js~FrequencyDataLoader.html">FrequencyDataLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/FrequencyPieChart.js~FrequencyPieChart.html">FrequencyPieChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/HeatmapChart.js~HeatmapChart.html">HeatmapChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/HistogramChart.js~HistogramChart.html">HistogramChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Legend.js~Legend.html">Legend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Legend.js~StaticLegend.html">StaticLegend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/LineChart.js~LineChart.html">LineChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/LineChartBase.js~LineChartBase.html">LineChartBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/LiveAnimation.js~LiveAnimation.html">LiveAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/MinMaxLoader.js~MinMaxLoader.html">MinMaxLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/OnOffAreaChart.js~OnOffAreaChart.html">OnOffAreaChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PanelConfig.js~Configurator.html">Configurator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PanelConfig.js~PanelConfigAccess.html">PanelConfigAccess</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PanelConfig.js~PdfExportDialog.html">PdfExportDialog</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PanelConfig.js~PermanentLinkDialog.html">PermanentLinkDialog</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PanelConfig.js~SaveDialog.html">SaveDialog</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/PieChart.js~StaticPieChart.html">StaticPieChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/RecordedAnimation.js~RecordedAnimation.html">RecordedAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Records.js~Records.html">Records</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/SVG.js~SVG.html">SVG</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/ScatterPlot.js~ScatterPlot.html">ScatterPlot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/ScatterPlotBase.js~ScatterPlotBase.html">ScatterPlotBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Selector.js~SignalSelector.html">SignalSelector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Selector.js~StaticSignalSelector.html">StaticSignalSelector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeBasedChartBase.js~TimeBasedChartBase.html">TimeBasedChartBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeContext.js~TimeContext.html">TimeContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeInterval.js~IntervalAbsolute.html">IntervalAbsolute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeInterval.js~IntervalHistory.html">IntervalHistory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeInterval.js~IntervalSpec.html">IntervalSpec</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeInterval.js~TimeInterval.html">TimeInterval</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeRangeSelector.js~PredefTimeRangeSelector.html">PredefTimeRangeSelector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/TimeRangeSelector.js~TimeRangeSelector.html">TimeRangeSelector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/Tooltip.js~Tooltip.html">Tooltip</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-animated">animated</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-forAggs">forAggs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getAxisIdx">getAxisIdx</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lineWithPointsOnHover">lineWithPointsOnHover</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lineWithoutPoints">lineWithoutPoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lineWithoutPointsAndPointsOnNoAggregation">lineWithoutPointsAndPointsOnNoAggregation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-nolineWithPointsAlways">nolineWithPointsAlways</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createBase">createBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isSignalVisible">isSignalVisible</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-intervalAccessMixin">intervalAccessMixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-defaultGetMinAggregationInterval">defaultGetMinAggregationInterval</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ModifyColorCopy">ModifyColorCopy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-WheelDelta">WheelDelta</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-brushHandlesLeftRight">brushHandlesLeftRight</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-brushHandlesTopBottom">brushHandlesTopBottom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-distance">distance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extentWithMargin">extentWithMargin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getColorScale">getColorScale</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getExtent">getExtent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isInExtent">isInExtent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isSignalVisible">isSignalVisible</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-roundTo">roundTo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setZoomTransform">setZoomTransform</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-transitionInterpolate">transitionInterpolate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-fileUrl">fileUrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnimationControlContext">AnimationControlContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnimationDataContext">AnimationDataContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnimationStatusContext">AnimationStatusContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-withAnimationControl">withAnimationControl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-withAnimationData">withAnimationData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-withAnimationStatus">withAnimationStatus</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TimeSeriesPointPredefs">TimeSeriesPointPredefs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TimeSeriesPointType">TimeSeriesPointType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-dataAccess">dataAccess</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PointsVisibility">PointsVisibility</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-pointsOnNoAggregation">pointsOnNoAggregation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PanelConfigOwnerContext">PanelConfigOwnerContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-panelConfigAccessMixin">panelConfigAccessMixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-panelConfigMixin">panelConfigMixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-withPanelConfig">withPanelConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-panelMenuMixin">panelMenuMixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-LegendPosition">LegendPosition</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ConfigDifference">ConfigDifference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RenderStatus">RenderStatus</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TimeIntervalsContext">TimeIntervalsContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ZoomEventSources">ZoomEventSources</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-dotShapeNames">dotShapeNames</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-dotShapes">dotShapes</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#attic">attic</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/attic/BarChart.js~BarChart.html">BarChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/attic/BarNavigator.js~LineNavigator.html">LineNavigator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ivis/attic/LineNavigator.js~BarNavigator.html">BarNavigator</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">ivis/TimeInterval.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

import moment
    from &quot;moment&quot;;
import * as dateMath
    from &quot;../lib/datemath&quot;;

const defaultChartWidth = 1000;

const predefAggregationIntervals = [
    moment.duration(1, &apos;ms&apos;),
    moment.duration(5, &apos;ms&apos;),
    moment.duration(10, &apos;ms&apos;),
    moment.duration(50, &apos;ms&apos;),
    moment.duration(100, &apos;ms&apos;),
    moment.duration(200, &apos;ms&apos;),
    moment.duration(500, &apos;ms&apos;),
    moment.duration(1, &apos;s&apos;),
    moment.duration(2, &apos;s&apos;),
    moment.duration(5, &apos;s&apos;),
    moment.duration(10, &apos;s&apos;),
    moment.duration(15, &apos;s&apos;),
    moment.duration(30, &apos;s&apos;),
    moment.duration(1, &apos;m&apos;),
    moment.duration(2, &apos;m&apos;),
    moment.duration(5, &apos;m&apos;),
    moment.duration(10, &apos;m&apos;),
    moment.duration(15, &apos;m&apos;),
    moment.duration(30, &apos;m&apos;),
    moment.duration(1, &apos;h&apos;),
    moment.duration(2, &apos;h&apos;),
    moment.duration(4, &apos;h&apos;),
    moment.duration(6, &apos;h&apos;),
    moment.duration(12, &apos;h&apos;),
    moment.duration(1, &apos;d&apos;),
    moment.duration(2, &apos;d&apos;),
    moment.duration(5, &apos;d&apos;),
    moment.duration(1, &apos;w&apos;),
    moment.duration(2, &apos;w&apos;),
    moment.duration(1, &apos;M&apos;)
];

export function defaultGetMinAggregationInterval(minPointDistance = 0) {
    return (intv, absFrom, absTo) =&gt; {
        const dif = (absTo - absFrom) / (intv.conf.chartWidth || defaultChartWidth);

        if (dif * 20 &lt;= minPointDistance) { // individual points should be at least 20 pixels apart
            return moment.duration(0, &apos;s&apos;);
        }

        const bucketSize = dif * 2; // minimal allowed bucket size in milliseconds (2 pixels per data point)

        return predefAggregationIntervals.find(x =&gt; bucketSize &lt;= x) || predefAggregationIntervals[predefAggregationIntervals.length - 1];
    }
}

export class IntervalSpec {
    constructor(from, to, aggregationInterval, refreshInterval) {
        this.from = from;
        this.to = to;
        this.aggregationInterval = aggregationInterval; /* null means auto, moment.duration(0, &apos;s&apos;) means no aggregation */
        this.refreshInterval = refreshInterval;
    }

    exportData() {
        return {
            from: this.from,
            to: this.to,
            aggregationInterval: this.aggregationInterval &amp;&amp; this.aggregationInterval.toISOString(),
            refreshInterval: this.refreshInterval &amp;&amp; this.refreshInterval.toISOString()
        }
    }

    static fromExportedData(exportedData) {
        return new IntervalSpec(
            exportedData.from,
            exportedData.to,
            exportedData.aggregationInterval &amp;&amp; moment.duration(exportedData.aggregationInterval),
            exportedData.refreshInterval &amp;&amp; moment.duration(exportedData.refreshInterval)
        );
    }

    freeze() {
        const {from, to} = this.getAbsoluteFromTo();

        return new IntervalSpec(
            from.toISOString(),
            to.toISOString(),
            this.aggregationInterval,
            this.refreshInterval
        );
    }

    getAbsoluteFromTo() {
        const from = dateMath.parse(this.from, false);
        const to = dateMath.parse(this.to, true);

        return {from, to};
    }
}

export class IntervalAbsolute {
    constructor(from, to, aggregationInterval) {
        this.from = from;
        this.to = to;
        this.aggregationInterval = aggregationInterval; /* null means auto, moment.duration(0, &apos;s&apos;) means no aggregation */
    }

    exportData() {
        return {
            from: this.from.toISOString(),
            to: this.to.toISOString(),
            aggregationInterval: this.aggregationInterval.toISOString()
        }
    }

    static fromExportedData(exportedData) {
        return new IntervalSpec(
            moment(exportedData.from),
            moment(exportedData.to),
            exportedData.aggregationInterval &amp;&amp; moment.duration(exportedData.aggregationInterval)
        );
    }
}

export class IntervalHistory {
    constructor(specs, idx) {
        this.specs = specs;
        this.idx = idx;
    }
}

let cnt = 0;
export class TimeInterval {
    constructor(onChange, data) {
        cnt += 1;
        this.cnt = cnt;
        this.started = false;

        this.refreshTimeout = null;

        this.onChange = onChange;
        this.successor = null;


        if (data &amp;&amp; data.conf) {
            this.conf = data.conf;
        } else {
            this.conf = {};
        }

        if (!this.conf.getMinAggregationInterval) {
            this.conf.getMinAggregationInterval = defaultGetMinAggregationInterval();
        }

        if (!this.conf.chartWidth) {
            this.conf.chartWidth = 0;
        }


        if (data) {
            this.spec = data.spec;

            if (data.history) {
                this.history = data.history;
            }
        } else {
            this.spec = new IntervalSpec(&apos;now-6h&apos;, &apos;now&apos;, null /* null means auto */, moment.duration(1, &apos;m&apos;));
        }

        if (!this.history) {
            this.history = {
                idx: 0,
                specs: [ this. spec ]
            };
        }

        if (data &amp;&amp; data.absolute) {
            this.absolute = data.absolute;
        } else {
            this._computeAbsolute();
        }
    }

    exportData() {
        if (this.successor) return this.successor.exportData();
        
        return {
            conf: {
                chartWidth: this.conf.chartWidth
            },
            spec: this.spec.exportData()
        };
    }

    static fromExportedData(onChange, exportedData) {
        const data = {
            conf: exportedData.conf,
            spec: IntervalSpec.fromExportedData(exportedData.spec)
        };

        return new TimeInterval(onChange, data);
    }

    freeze() {
        if (this.successor) return this.successor.freeze();

        const intv = this._clone();
        intv.spec = intv.spec.freeze();

        return intv;
    }

    start() {
        if (this.successor) return this.successor.start();

        this._start();
    }

    stop() {
        if (this.successor) return this.successor.stop();

        this.started = false;
        clearTimeout(this.refreshTimeout);
    }

    setSpec(spec, replaceHistory = false) {
        if (this.successor) return this.successor.setSpec(spec, replaceHistory);

        const intv = this._clone();

        intv.spec = new IntervalSpec(
            spec.from !== undefined ? spec.from : this.spec.from,
            spec.to !== undefined ? spec.to : this.spec.to,
            spec.aggregationInterval !== undefined ? spec.aggregationInterval : this.spec.aggregationInterval,
            spec.refreshInterval !== undefined ? spec.refreshInterval : this.spec.refreshInterval
        );

        let specs;
        if (replaceHistory) {
            specs = intv.history.specs.slice(0, intv.history.idx);
        } else {
            specs = intv.history.specs.slice(0, intv.history.idx + 1);
        }

        specs.push(spec);
        intv.history = new IntervalHistory(specs, specs.length - 1);

        clearTimeout(this.refreshTimeout);
        if (this.started) {
            intv._start();
        }

        intv._computeAbsolute();
        intv._notifyChange(&apos;spec&apos;);

        return intv;
    }

    setConf(conf) {
        if (this.successor) return this.successor.setConf(conf);

        const intv = this._clone();
        Object.assign(intv.conf, conf);

        clearTimeout(this.refreshTimeout);
        if (this.started) {
            intv._start();
        }

        intv._computeAbsolute();
        intv._notifyChange(&apos;absolute&apos;);

        return intv;
    }

    refresh() {
        if (this.successor) return this.successor.refresh();

        const intv = this._clone();

        clearTimeout(this.refreshTimeout);
        if (this.started) {
            intv._start();
        }

        intv._computeAbsolute();
        intv._notifyChange(&apos;absolute&apos;);

        return intv;
    }

    goBack() {
        if (this.successor) return this.successor.goBack();

        if (this.history.idx &gt; 0) {
            const intv = this._clone();

            intv.history = new IntervalHistory(intv.history.specs, intv.history.idx - 1);

            intv.spec = intv.history.specs[intv.history.idx];

            clearTimeout(this.refreshTimeout);
            if (this.started) {
                intv._start();
            }

            intv._computeAbsolute();
            intv._notifyChange(&apos;spec&apos;);

            return intv;
        }

        return this;
    }

    goForward() {
        if (this.successor) return this.successor.goForward();

        if (this.history.idx &lt; this.history.specs.length - 1) {
            const intv = this._clone();

            intv.history = new IntervalHistory(intv.history.specs, intv.history.idx + 1);

            intv.spec = intv.history.specs[intv.history.idx];

            clearTimeout(this.refreshTimeout);
            if (this.started) {
                intv._start();
            }

            intv._computeAbsolute();
            intv._notifyChange(&apos;spec&apos;);
        }

        return this;
    }


    getMinAggregationInterval(absFrom, absTo) {
        return this.conf.getMinAggregationInterval(this, absFrom, absTo);
    }

    roundToMinAggregationInterval(absFrom, absTo) {
        const minAggInterval = this.getMinAggregationInterval(absFrom, absTo);
        if (minAggInterval.valueOf() === 0) {
            return {from: moment(absFrom), to: moment(absTo)};
        } else {
            const from = moment(Math.round(absFrom / minAggInterval) * minAggInterval);
            const to = moment(Math.round(absTo / minAggInterval) * minAggInterval);

            return {from, to};
        }
    }


    _clone() {
        return new TimeInterval(this.onChange, this);
    }

    _start() {
        this.started = true;
        this._scheduleRefreshTimeout();
    }

    _computeAbsolute() {
        const {from, to} = this.spec.getAbsoluteFromTo();

        const minAggregationInterval = this.getMinAggregationInterval(from, to);

        let aggregationInterval;
        if (this.spec.aggregationInterval === null ||
            (this.spec.aggregationInterval.valueOf() !== 0 &amp;&amp; this.spec.aggregationInterval &lt; minAggregationInterval)) {
            aggregationInterval = minAggregationInterval;
        } else {
            aggregationInterval = this.spec.aggregationInterval;
        }

        this.absolute = new IntervalAbsolute(from, to, aggregationInterval);
    }

    _scheduleRefreshTimeout() {
        if (this.started &amp;&amp; this.spec.refreshInterval) {
            this.refreshTimeout = setTimeout(() =&gt; {
                const intv = this._clone();
                this.successor = intv;

                intv.started = this.started;
                intv._computeAbsolute();
                intv._notifyChange(&apos;absolute&apos;);
                intv._scheduleRefreshTimeout();
            }, this.spec.refreshInterval.asMilliseconds());
        }
    }

    _notifyChange(type) {
        if (this.started) {
            if (this.onChange) {
                this.onChange(type, this);
            }
        }
    }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
